<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë†€ëŸ¬ì™€ìš” ë™ë¬´ì˜ ìˆ² - ì§€ë¸Œë¦¬ ê³ ê¸‰ ì—ë””ì…˜</title>
  <link rel="stylesheet" href="style.css">
  <script src="/socket.io/socket.io.js"></script>
  <script src="particles.js" defer></script>
  <script src="socket.js" defer></script>
  <script src="admin.js" defer></script>
</head>
<body>
  <!-- ê°œë°œì ì½˜ì†” (ì‹¤ì‹œê°„ ë¡œê·¸, ì¢Œì¸¡ ìƒë‹¨ ê³ ì •) -->
  <div id="dev-console">
    <h4>ê°œë°œì ì½˜ì†”</h4>
    <div id="console-log"></div>
  </div>

  <!-- ë¡œê·¸ì¸/íšŒì›ê°€ì… í™”ë©´ -->
  <div id="auth-section">
    <h1>ğŸŒ³ ë†€ëŸ¬ì™€ìš” ë™ë¬´ì˜ ìˆ² ğŸŒ³</h1>
    <div id="signup">
      <h2>íšŒì›ê°€ì…</h2>
      <input id="signup-id" placeholder="ì•„ì´ë””"><br>
      <input id="signup-password" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸"><br>
      <input id="signup-nickname" placeholder="ë‹‰ë„¤ì„"><br>
      <button onclick="signup()">íšŒì›ê°€ì…</button>
    </div>

    <div id="login">
      <h2>ë¡œê·¸ì¸</h2>
      <input id="login-id" placeholder="ì•„ì´ë””"><br>
      <input id="login-password" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸"><br>
      <button onclick="login()">ë¡œê·¸ì¸</button>
    </div>

    <div id="recover">
      <h3>ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</h3>
      <input id="recover-id" placeholder="ì•„ì´ë”” ì…ë ¥"><br>
      <button onclick="recoverPassword()">ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°</button>
    </div>

    <div id="change-password">
      <h3>ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</h3>
      <input id="change-id" placeholder="ì•„ì´ë”” ì…ë ¥"><br>
      <input id="change-old-password" type="password" placeholder="ê¸°ì¡´ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥"><br>
      <input id="change-new-password" type="password" placeholder="ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì…ë ¥"><br>
      <button onclick="changePassword()">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</button>
    </div>
  </div>

  <!-- ì±„íŒ…ë°© ë° ì»¤ë®¤ë‹ˆí‹° í™”ë©´ -->
  <div id="chat-section" style="display:none;">
    <div id="profile-bar">
      <span id="user-info"></span>
      <button onclick="openProfileSettings()">í”„ë¡œí•„ ì„¤ì •</button>
      <button onclick="deleteAccount()">ê³„ì • ì‚­ì œ</button>
      <button onclick="logout()">ë¡œê·¸ì•„ì›ƒ</button>
    </div>
    
    <div id="room-section">
      <h2 id="welcome-text"></h2>
      <div id="room-controls">
        <button onclick="createRoom()">ë°© ë§Œë“¤ê¸°</button>
        <button onclick="showRoomList()">ë°© ëª©ë¡ ë³´ê¸°</button>
        <!-- ì •ë ¬ ë²„íŠ¼ -->
        <button onclick="sortRooms('latest')">ìµœì‹ ìˆœ</button>
        <button onclick="sortRooms('empty')">ë¹ˆ ë°© ìˆœ</button>
      </div>
      <div id="room-list" style="display:none;"></div>
    </div>

    <div id="friend-section">
      <h3>ì¹œêµ¬ ëª©ë¡</h3>
      <button onclick="showFriendList()">ì¹œêµ¬ ëª©ë¡ ë³´ê¸°</button>
      <div id="friend-list" style="display:none;"></div>
    </div>

    <!-- ì±„íŒ… ì˜ì—­ -->
    <div id="chat-container">
      <ul id="messages"></ul>
      <form id="chat-form">
        <input id="messageInput" autocomplete="off" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”" />
        <button type="submit">ë³´ë‚´ê¸°</button>
      </form>
    </div>

    <!-- ê´€ë¦¬ì ëª¨ë“œ ë²„íŠ¼ -->
    <button id="admin-button" onclick="openAdminLogin()">ğŸ”’</button>

    <!-- í…Œë§ˆ ë³€ê²½ ë²„íŠ¼ -->
    <div id="theme-buttons">
      <button onclick="changeTheme('spring')">ğŸŒ¸ ë´„</button>
      <button onclick="changeTheme('summer')">â˜€ï¸ ì—¬ë¦„</button>
      <button onclick="changeTheme('autumn')">ğŸ ê°€ì„</button>
      <button onclick="changeTheme('winter')">â„ï¸ ê²¨ìš¸</button>
      <button onclick="changeTheme('rain')">â˜” ë¹„</button>
      <button onclick="changeTheme('snow')">ğŸŒ¨ï¸ ëˆˆ</button>
      <button onclick="changeTime('morning')">ğŸŒ… ì•„ì¹¨</button>
      <button onclick="changeTime('day')">ğŸŒ ë‚®</button>
      <button onclick="changeTime('evening')">ğŸŒ‡ ì €ë…</button>
      <button onclick="changeTime('night')">ğŸŒ™ ë°¤</button>
    </div>

    <!-- ë‹¤í¬ëª¨ë“œ í† ê¸€ -->
    <button id="darkmode-toggle" onclick="toggleDarkMode()">ğŸŒ‘ ë‹¤í¬ëª¨ë“œ</button>

    <!-- ì ‘ì†ì ë³´ê¸° ë²„íŠ¼ -->
    <button id="show-users-button" onclick="toggleUserList()">ğŸ‘¥ ì ‘ì†ì ë³´ê¸°</button>
    <div id="online-users" style="display:none;">
      <button onclick="pinUserList()">ğŸ“Œ ê³ ì •í•˜ê¸°</button>
      <div id="user-list-content"></div>
    </div>

    <!-- ê´€ë¦¬ì íŒ¨ë„ -->
    <div id="admin-panel" style="display:none;">
      <h3>ê´€ë¦¬ì íŒ¨ë„</h3>
      <button onclick="deleteAllMessages()">ì „ì²´ ëŒ€í™” ì‚­ì œ</button>
      <button onclick="sendAnnouncement()">ê³µì§€ ë³´ë‚´ê¸°</button>
      <button onclick="lockRoom()">ë°© ì ê¸ˆ/í•´ì œ</button>
      <!-- (ì¶”í›„) ê°•í‡´/ë²¤ ê¸°ëŠ¥ ë²„íŠ¼ í¬í•¨ -->
      <button onclick="kickUser()">ê°•í‡´</button>
      <button onclick="banUser()">ë²¤</button>
    </div>
  </div>

  <!-- ê´€ë¦¬ì ë¡œê·¸ì¸ ì°½ -->
  <div id="admin-login" style="display:none;">
    <h3>ê´€ë¦¬ì ë¡œê·¸ì¸</h3>
    <input id="admin-password" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥">
    <button onclick="verifyAdmin()">í™•ì¸</button>
  </div>

  <!-- í”„ë¡œí•„ ì„¤ì • íŒì—… -->
  <div id="profile-settings" style="display:none;">
    <h3>í”„ë¡œí•„ ì„¤ì •</h3>
    <input id="profile-nickname" placeholder="ë‹‰ë„¤ì„"><br>
    <input id="profile-status" placeholder="ìƒíƒœ ë©”ì‹œì§€"><br>
    <input id="profile-image" placeholder="í”„ë¡œí•„ ì´ë¯¸ì§€ URL (ì„ íƒ)"><br>
    <button onclick="updateProfile()">í”„ë¡œí•„ ì—…ë°ì´íŠ¸</button>
    <button onclick="closeProfileSettings()">ë‹«ê¸°</button>
  </div>

  <!-- ê¸°ë³¸ ìŠ¤í¬ë¦½íŠ¸ ë¡œì§ (í•˜ë‹¨ì— ì¶”ê°€ëœ ëª¨ë“  í•¨ìˆ˜ í¬í•¨) -->
  <script>
  // íšŒì›ê°€ì…, ë¡œê·¸ì¸, ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°, ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ê´€ë ¨ í•¨ìˆ˜ë“¤ì€ ì´ì „ê³¼ ë™ì¼
  function signup() {
    const id = document.getElementById('signup-id').value;
    const password = document.getElementById('signup-password').value;
    const nickname = document.getElementById('signup-nickname').value;
    fetch('/signup', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ id, password, nickname })
    })
    .then(res => res.text())
    .then(msg => { alert(msg); })
    .catch(err => { alert('íšŒì›ê°€ì… ì‹¤íŒ¨: ' + err.message); });
  }

  function login() {
    const id = document.getElementById('login-id').value;
    const password = document.getElementById('login-password').value;
    fetch('/login', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ id, password })
    })
    .then(res => res.json())
    .then(data => {
      document.getElementById('auth-section').style.display = 'none';
      document.getElementById('chat-section').style.display = 'block';
      document.getElementById('welcome-text').innerText = `${data.nickname}ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤!`;
      document.getElementById('user-info').innerText = `ì•„ì´ë””: ${document.getElementById('login-id').value} / ë‹‰ë„¤ì„: ${data.nickname}`;
      connectUser(data.nickname, document.getElementById('login-id').value);
    })
    .catch(err => { alert('ë¡œê·¸ì¸ ì‹¤íŒ¨: ' + err.message); });
  }

  function recoverPassword() {
    const id = document.getElementById('recover-id').value;
    fetch('/recover', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ id })
    })
    .then(res => res.json())
    .then(data => { alert(`ì„ì‹œ ë¹„ë°€ë²ˆí˜¸: ${data.tempPassword}`); })
    .catch(err => { alert('ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸° ì‹¤íŒ¨: ' + err.message); });
  }

  function changePassword() {
    const id = document.getElementById('change-id').value;
    const oldPassword = document.getElementById('change-old-password').value;
    const newPassword = document.getElementById('change-new-password').value;
    fetch('/change-password', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ id, oldPassword, newPassword })
    })
    .then(res => res.text())
    .then(msg => { alert(msg); })
    .catch(err => { alert('ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì‹¤íŒ¨: ' + err.message); });
  }

  // í”„ë¡œí•„ ì„¤ì •
  function openProfileSettings() {
    document.getElementById('profile-settings').style.display = 'block';
  }
  function closeProfileSettings() {
    document.getElementById('profile-settings').style.display = 'none';
  }
  function updateProfile() {
    const nickname = document.getElementById('profile-nickname').value;
    const status = document.getElementById('profile-status').value;
    const image = document.getElementById('profile-image').value;
    // ì´ ê°’ë“¤ì„ ì„œë²„ì— ì €ì¥í•˜ëŠ” ë¡œì§ì„ ì¶”ê°€í•´ì•¼ í•¨ (ìŠ¤í…)
    alert('í”„ë¡œí•„ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤!');
    closeProfileSettings();
  }

  // ê³„ì • ì‚­ì œ
  function deleteAccount() {
    if (confirm('ì •ë§ ê³„ì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
      const id = document.getElementById('login-id').value;
      const password = prompt('ê³„ì • ì‚­ì œë¥¼ ìœ„í•´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”:');
      fetch('/delete-account', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ id, password })
      })
      .then(res => res.text())
      .then(msg => { alert(msg); location.reload(); })
      .catch(err => { alert('ê³„ì • ì‚­ì œ ì‹¤íŒ¨: ' + err.message); });
    }
  }

  // ë¡œê·¸ì•„ì›ƒ
  function logout() {
    location.reload();
  }

  // ê´€ë¦¬ì ëª¨ë“œ
  function openAdminLogin() {
    document.getElementById('admin-login').style.display = 'block';
  }
  function verifyAdmin() {
    const password = document.getElementById('admin-password').value;
    if (password === '75271356') {
      document.getElementById('admin-login').style.display = 'none';
      document.getElementById('admin-panel').style.display = 'block';
      alert('ê´€ë¦¬ì ëª¨ë“œ ì§„ì… ì„±ê³µ!');
    } else {
      alert('ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.');
    }
  }

  // ì‹¤ì‹œê°„ ì ‘ì†ì ê´€ë¦¬ (íŒì—…)
  function toggleUserList() {
    const list = document.getElementById('online-users');
    list.style.display = list.style.display === 'none' ? 'block' : 'none';
  }
  function pinUserList() {
    const list = document.getElementById('online-users');
    list.style.position = 'fixed';
    list.style.top = '10px';
    list.style.right = '10px';
  }

  // ë‹¤í¬ëª¨ë“œ í† ê¸€
  function toggleDarkMode() {
    document.body.classList.toggle('dark-mode');
  }

  // í…Œë§ˆ, ì‹œê°„ ë³€ê²½ â€“ ì—¬ê¸°ì„œëŠ” socket ëª…ë ¹ ë³´ë‚´ê¸° (ì‹¤ì œë¡œ particles.jsì—ì„œ ì• ë‹ˆë©”ì´ì…˜ ì²˜ë¦¬)
  function changeTheme(season) {
    socket.emit('admin background change', season);
  }
  function changeTime(time) {
    socket.emit('admin background change', time);
  }

  // ì—°ê²°ëœ ìœ ì € ì •ë³´ ì „ì†¡ (ë¡œê·¸ì¸ í›„)
  function connectUser(nickname, id) {
    socket.emit('user connected', { nickname, id });
  }

  // ê°œë°œììš© ì½˜ì†” ë¡œê·¸ ì „ì†¡ (ìŠ¤í…)
  function logEvent(log) {
    socket.emit('log event', log);
    const consoleLog = document.getElementById('console-log');
    const entry = document.createElement('div');
    entry.innerText = log;
    consoleLog.appendChild(entry);
  }
  </script>
</body>
</html>
