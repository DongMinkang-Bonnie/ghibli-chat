<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ë†€ëŸ¬ì™€ìš” ë™ë¬´ì˜ ìˆ²</title>
  <link rel="stylesheet" href="style.css">
  <script src="/socket.io/socket.io.js"></script>
  <script src="socket.js" defer></script>
  <script src="admin.js" defer></script>
</head>
<body>

<div id="auth-section">
  <h1>ë†€ëŸ¬ì™€ìš” ë™ë¬´ì˜ ìˆ²</h1>
  <div id="signup">
    <h2>íšŒì›ê°€ì…</h2>
    <input id="signup-id" placeholder="ì•„ì´ë””"><br>
    <input id="signup-password" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸"><br>
    <input id="signup-nickname" placeholder="ë‹‰ë„¤ì„"><br>
    <button onclick="signup()">íšŒì›ê°€ì…</button>
  </div>

  <div id="login">
    <h2>ë¡œê·¸ì¸</h2>
    <input id="login-id" placeholder="ì•„ì´ë””"><br>
    <input id="login-password" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸"><br>
    <button onclick="login()">ë¡œê·¸ì¸</button>
  </div>
</div>

<div id="chat-section" style="display:none;">
  <h2 id="welcome-text"></h2>

  <ul id="messages"></ul>

  <form id="chat-form">
    <input id="messageInput" autocomplete="off" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”" />
    <button type="submit">ë³´ë‚´ê¸°</button>
  </form>

  <!-- ê´€ë¦¬ì ëª¨ë“œ ë²„íŠ¼ -->
  <button id="admin-button" onclick="openAdminLogin()">ğŸ”’</button>

  <!-- í…Œë§ˆ ë³€ê²½ ë²„íŠ¼ë“¤ -->
  <div id="theme-buttons">
    <button onclick="changeTheme('rain')">â˜” ë¹„</button>
    <button onclick="changeTheme('snow')">â„ï¸ ëˆˆ</button>
    <button onclick="changeTheme('flowers')">ğŸŒ¸ ê½ƒ</button>
    <button onclick="changeTheme('wind')">ğŸƒ ë°”ëŒ</button>
  </div>

  <!-- ì ‘ì†ì ë³´ê¸° ë²„íŠ¼ -->
  <button id="show-users-button" onclick="toggleUserList()">ğŸ‘¥ ì ‘ì†ì ë³´ê¸°</button>

  <!-- ì ‘ì†ì ëª©ë¡ íŒì—… -->
  <div id="online-users" style="display:none;">
    <button onclick="pinUserList()">ğŸ“Œ ê³ ì •í•˜ê¸°</button>
    <div id="user-list-content"></div>
  </div>

  <!-- ê´€ë¦¬ì íŒ¨ë„ (ìˆ¨ê²¨ì§„ í™”ë©´) -->
  <div id="admin-panel" style="display:none;">
    <h3>ê´€ë¦¬ì íŒ¨ë„</h3>
    <button onclick="deleteAllMessages()">ì „ì²´ ëŒ€í™” ì‚­ì œ</button>
    <button onclick="sendAnnouncement()">ê³µì§€ ë³´ë‚´ê¸°</button>
    <button onclick="lockRoom()">ë°© ì ê¸ˆ/í•´ì œ</button>
  </div>
</div>

<!-- ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ì°½ -->
<div id="admin-login" style="display:none;">
  <h3>ê´€ë¦¬ì ë¡œê·¸ì¸</h3>
  <input id="admin-password" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥">
  <button onclick="verifyAdmin()">í™•ì¸</button>
</div>

<script>
function signup() {
  const id = document.getElementById('signup-id').value;
  const password = document.getElementById('signup-password').value;
  const nickname = document.getElementById('signup-nickname').value;

  fetch('/signup', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ id, password, nickname })
  })
  .then(res => res.text())
  .then(msg => {
    alert(msg);
  })
  .catch(err => {
    alert('íšŒì›ê°€ì… ì‹¤íŒ¨: ' + err.message);
  });
}

function login() {
  const id = document.getElementById('login-id').value;
  const password = document.getElementById('login-password').value;

  fetch('/login', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ id, password })
  })
  .then(res => res.json())
  .then(data => {
    document.getElementById('auth-section').style.display = 'none';
    document.getElementById('chat-section').style.display = 'block';
    document.getElementById('welcome-text').innerText = `${data.nickname}ë‹˜ í™˜ì˜í•©ë‹ˆë‹¤!`;
    connectUser(data.nickname, id);
  })
  .catch(err => {
    alert('ë¡œê·¸ì¸ ì‹¤íŒ¨: ' + err.message);
  });
}

function openAdminLogin() {
  document.getElementById('admin-login').style.display = 'block';
}

function verifyAdmin() {
  const password = document.getElementById('admin-password').value;
  if (password === '75271356') {
    document.getElementById('admin-login').style.display = 'none';
    document.getElementById('admin-panel').style.display = 'block';
    alert('ê´€ë¦¬ì ëª¨ë“œ ì§„ì… ì„±ê³µ!');
  } else {
    alert('ë¹„ë°€ë²ˆí˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤.');
  }
}

// ì ‘ì†ì ëª©ë¡ í† ê¸€
function toggleUserList() {
  const list = document.getElementById('online-users');
  list.style.display = list.style.display === 'none' ? 'block' : 'none';
}

// ì ‘ì†ì ëª©ë¡ ê³ ì •
function pinUserList() {
  const list = document.getElementById('online-users');
  list.style.position = 'fixed';
  list.style.top = '10px';
  list.style.right = '10px';
}

// ë°°ê²½ í…Œë§ˆ ë³€ê²½
function changeTheme(theme) {
  let themeUrl = '';

  if (theme === 'rain') {
    themeUrl = 'https://cdn.pixabay.com/photo/2015/10/28/15/51/rain-1015609_960_720.jpg';
  } else if (theme === 'snow') {
    themeUrl = 'https://cdn.pixabay.com/photo/2017/01/18/15/44/snow-1997281_960_720.jpg';
  } else if (theme === 'flowers') {
    themeUrl = 'https://cdn.pixabay.com/photo/2017/08/01/08/29/flowers-2566240_960_720.jpg';
  } else if (theme === 'wind') {
    themeUrl = 'https://cdn.pixabay.com/photo/2016/09/21/11/34/landscape-1685431_960_720.jpg';
  }

  socket.emit('admin background change', themeUrl);
}
</script>

</body>
</html>
