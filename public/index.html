<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>놀러와요 동무의 숲 - 지브리 에디션</title>
  <link rel="stylesheet" href="style.css">
  <script src="/socket.io/socket.io.js"></script>
  <script src="particles.js" defer></script>
  <script src="socket.js" defer></script>
  <script src="admin.js" defer></script>
</head>
<body>

<!-- 로그인/회원가입 화면 -->
<div id="auth-section">
  <h1>🌳 놀러와요 동무의 숲 🌳</h1>
  <div id="signup">
    <h2>회원가입</h2>
    <input id="signup-id" placeholder="아이디"><br>
    <input id="signup-password" type="password" placeholder="비밀번호"><br>
    <input id="signup-nickname" placeholder="닉네임"><br>
    <button onclick="signup()">회원가입</button>
  </div>

  <div id="login">
    <h2>로그인</h2>
    <input id="login-id" placeholder="아이디"><br>
    <input id="login-password" type="password" placeholder="비밀번호"><br>
    <button onclick="login()">로그인</button>
  </div>

  <div id="recover">
    <h3>비밀번호 찾기</h3>
    <input id="recover-id" placeholder="아이디 입력"><br>
    <button onclick="recoverPassword()">비밀번호 찾기</button>
  </div>
</div>

<!-- 채팅방 화면 -->
<div id="chat-section" style="display:none;">
  <h2 id="welcome-text"></h2>

  <ul id="messages"></ul>

  <form id="chat-form">
    <input id="messageInput" autocomplete="off" placeholder="메시지를 입력하세요" />
    <button type="submit">보내기</button>
  </form>

  <!-- 관리자 모드 버튼 -->
  <button id="admin-button" onclick="openAdminLogin()">🔒</button>

  <!-- 테마 변경 버튼 -->
  <div id="theme-buttons">
    <button onclick="changeTheme('spring')">🌸 봄</button>
    <button onclick="changeTheme('summer')">☀️ 여름</button>
    <button onclick="changeTheme('autumn')">🍁 가을</button>
    <button onclick="changeTheme('winter')">❄️ 겨울</button>
    <button onclick="changeTheme('rain')">☔ 비</button>
    <button onclick="changeTheme('snow')">🌨️ 눈</button>
    <button onclick="changeTime('morning')">🌅 아침</button>
    <button onclick="changeTime('day')">🌞 낮</button>
    <button onclick="changeTime('evening')">🌇 저녁</button>
    <button onclick="changeTime('night')">🌙 밤</button>
  </div>

  <!-- 다크모드 토글 버튼 -->
  <button id="darkmode-toggle" onclick="toggleDarkMode()">🌑 다크모드</button>

  <!-- 접속자 보기 버튼 -->
  <button id="show-users-button" onclick="toggleUserList()">👥 접속자 보기</button>

  <!-- 접속자 목록 팝업 -->
  <div id="online-users" style="display:none;">
    <button onclick="pinUserList()">📌 고정하기</button>
    <div id="user-list-content"></div>
  </div>

  <!-- 관리자 패널 (숨겨진 화면) -->
  <div id="admin-panel" style="display:none;">
    <h3>관리자 패널</h3>
    <button onclick="deleteAllMessages()">전체 대화 삭제</button>
    <button onclick="sendAnnouncement()">공지 보내기</button>
    <button onclick="lockRoom()">방 잠금/해제</button>
  </div>
</div>

<!-- 관리자 로그인 입력창 -->
<div id="admin-login" style="display:none;">
  <h3>관리자 로그인</h3>
  <input id="admin-password" type="password" placeholder="비밀번호 입력">
  <button onclick="verifyAdmin()">확인</button>
</div>

<!-- 기본 스크립트 로직 -->
<script>
function signup() {
  const id = document.getElementById('signup-id').value;
  const password = document.getElementById('signup-password').value;
  const nickname = document.getElementById('signup-nickname').value;

  fetch('/signup', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ id, password, nickname })
  })
  .then(res => res.text())
  .then(msg => {
    alert(msg);
  })
  .catch(err => {
    alert('회원가입 실패: ' + err.message);
  });
}

function login() {
  const id = document.getElementById('login-id').value;
  const password = document.getElementById('login-password').value;

  fetch('/login', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ id, password })
  })
  .then(res => res.json())
  .then(data => {
    document.getElementById('auth-section').style.display = 'none';
    document.getElementById('chat-section').style.display = 'block';
    document.getElementById('welcome-text').innerText = `${data.nickname}님 환영합니다!`;
    connectUser(data.nickname, id);
  })
  .catch(err => {
    alert('로그인 실패: ' + err.message);
  });
}

function recoverPassword() {
  const id = document.getElementById('recover-id').value;

  fetch('/recover', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ id })
  })
  .then(res => res.json())
  .then(data => {
    alert(`임시 비밀번호: ${data.tempPassword}`);
  })
  .catch(err => {
    alert('비밀번호 찾기 실패: ' + err.message);
  });
}

function openAdminLogin() {
  document.getElementById('admin-login').style.display = 'block';
}

function verifyAdmin() {
  const password = document.getElementById('admin-password').value;
  if (password === '75271356') {
    document.getElementById('admin-login').style.display = 'none';
    document.getElementById('admin-panel').style.display = 'block';
    alert('관리자 모드 진입 성공!');
  } else {
    alert('비밀번호가 틀렸습니다.');
  }
}

function toggleUserList() {
  const list = document.getElementById('online-users');
  list.style.display = list.style.display === 'none' ? 'block' : 'none';
}

function pinUserList() {
  const list = document.getElementById('online-users');
  list.style.position = 'fixed';
  list.style.top = '10px';
  list.style.right = '10px';
}

function toggleDarkMode() {
  document.body.classList.toggle('dark-mode');
}

function changeTheme(season) {
  socket.emit('admin background change', season);
}

function changeTime(time) {
  socket.emit('admin background change', time);
}
</script>

</body>
</html>
