<script src="/socket.io/socket.io.js"></script>
<script>
  const socket = io();
  const form = document.getElementById('chatForm');
  const input = document.getElementById('messageInput');
  const messages = document.getElementById('messages');

  // 새로고침해도 채팅기록 남기기
  function saveMessages() {
    localStorage.setItem('chatMessages', messages.innerHTML);
  }

  function loadMessages() {
    const saved = localStorage.getItem('chatMessages');
    if (saved) {
      messages.innerHTML = saved;
    }
  }

  loadMessages(); // 페이지 열리면 저장된 메시지 불러오기

  form.addEventListener('submit', function(e) {
    e.preventDefault();
    if (input.value) {
      socket.emit('chat message', input.value);
      input.value = '';
    }
  });

  socket.on('chat message', function(msg) {
    const item = document.createElement('li');
    item.textContent = msg;
    messages.appendChild(item);
    saveMessages(); // 채팅 받을 때마다 저장

    // 🔥 새 메시지가 추가될 때마다 자동 스크롤 맨 아래로 이동!
    messages.scrollTop = messages.scrollHeight;
  });
</script>
